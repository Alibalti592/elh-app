<!DOCTYPE html>
{% set htmlLocale = app.request.locale %}
{% set location = testament.location|default('')|trim %}
{% set toilette = testament.toilette|default('')|trim %}
{% set family = testament.family|default('')|trim %}
{% set fixe = testament.fixe|default('')|trim %}
{% set goods = testament.goods|default('')|trim %}
{% set lastwill = testament.lastwill|default('')|trim %}
{% set jeunTextValue = jeunText|default('')|trim %}
{% set hasRitesSection = location != '' or toilette != '' or family != '' %}
{% set hasDebtSection = fixe != '' or goods != '' or lastwill != '' %}
{% set hasFastingSection = jeunTextValue != '' %}
{% set hasFinancialDetails = jeds is not empty or onms is not empty or amanas is not empty %}
<html lang="{{ htmlLocale }}">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Testament {{ appName }}</title>
  <style>
      @page {
          margin: 22px;
      }

      * {
          box-sizing: border-box;
      }

      body {
          margin: 0;
          background: #f9f6f1;
          color: #1f2937;
          font-family: "DejaVu Sans", Arial, sans-serif;
          font-size: 12px;
          line-height: 1.5;
      }

      .page {
          width: 100%;
          max-width: 760px;
          margin: 0 auto;
      }

      .card {
          background: #ffffff;
          border: 1px solid #f0e5d6;
          border-radius: 24px;
          padding: 30px 30px 26px;
          margin-bottom: 16px;
      }

      .card-content {
          width: 100%;
          padding-bottom: 120px;
      }

      .main-card {
          position: relative;
          overflow: hidden;
          min-height: 255mm;
      }

      .accent-bar {
          position: absolute;
          top: 0;
          left: 0;
          width: 7px;
          height: 100%;
          background: #e7d6be;
      }

      .quote {
          margin: 0 0 26px;
          padding: 0 4px 20px;
          text-align: center;
          color: #6b7280;
          font-size: 14px;
          line-height: 1.65;
          font-style: italic;
          border-bottom: 1px solid #f1e8db;
      }

      .quote-ref {
          margin-top: 6px;
          color: #8f9779;
          font-style: normal;
          font-weight: 700;
          font-size: 12px;
          opacity: 0.85;
      }

      .title-wrap {
          text-align: center;
          margin-bottom: 28px;
      }

      .title-wrap h1 {
          margin: 0 0 8px;
          color: #8f9779;
          font-family: "Times New Roman", Georgia, serif;
          font-size: 36px;
          font-weight: 700;
      }

      .title-wrap p {
          margin: 0;
          color: #94a3b8;
          font-size: 10px;
          text-transform: uppercase;
          letter-spacing: 2px;
      }

      .section {
          margin-bottom: 24px;
      }

      .section:last-child {
          margin-bottom: 0;
      }

      .section-heading {
          margin: 0 0 10px;
          font-size: 14px;
          font-weight: 700;
          text-transform: uppercase;
          letter-spacing: 1px;
          color: #8f9779;
      }

      .section-icon {
          display: inline-block;
          width: 16px;
          height: 16px;
          margin-right: 8px;
          vertical-align: -2px;
      }

      .section-icon svg {
          display: block;
          width: 16px;
          height: 16px;
          fill: #8f9779;
      }

      .field {
          margin: 0 0 10px;
      }

      .field:last-child {
          margin-bottom: 0;
      }

      .field-label {
          margin: 0 0 5px;
          color: #6b7280;
          font-size: 13px;
      }

      .field-value {
          margin: 0;
          color: #111827;
          font-weight: 600;
          padding: 8px 10px;
          background: #faf6f0;
          border: 1px solid #efe3d3;
          border-radius: 10px;
      }

      .fasting-box {
          margin-top: 4px;
          padding: 14px 16px;
          text-align: center;
          background: #faf6f0;
          border: 1px solid #d7c3aa;
          border-radius: 12px;
          color: #374151;
          font-size: 14px;
          font-weight: 700;
          line-height: 1.6;
      }

      .brand {
          position: absolute;
          left: 30px;
          right: 30px;
          bottom: 26px;
          text-align: center;
          page-break-inside: avoid;
      }

      .brand-name {
          margin: 0;
          color: #8f9779;
          font-family: "Times New Roman", Georgia, serif;
          font-size: 21px;
          letter-spacing: 0.5px;
      }

      .brand-sub {
          margin: 3px 0 0;
          color: #a39b8e;
          font-size: 10px;
          text-transform: uppercase;
          letter-spacing: 2px;
      }

      .brand-logo {
          width: 120px;
          display: block;
          margin: 14px auto 0;
      }

      .annex-title {
          margin: 10px 0 12px;
          color: #8f9779;
          font-family: "Times New Roman", Georgia, serif;
          font-size: 30px;
          text-align: center;
      }

      .debt-group {
          margin-bottom: 18px;
      }

      .debt-group:last-child {
          margin-bottom: 0;
      }

      .debt-group h3 {
          margin: 0 0 10px;
          color: #8f9779;
          font-size: 16px;
          text-transform: uppercase;
          letter-spacing: 0.8px;
      }

      .debt-card {
          background: #fffcf8;
          border: 1px solid #f0e4d4;
          border-radius: 12px;
          padding: 11px 12px;
          margin-bottom: 8px;
      }

      .debt-card:last-child {
          margin-bottom: 0;
      }

      .debt-line {
          margin: 0 0 4px;
          color: #6b7280;
      }

      .debt-line:last-child {
          margin-bottom: 0;
      }

      .debt-line strong {
          color: #111827;
      }

  </style>
</head>
<body>
<div class="page">
  <div class="card main-card">
    <div class="accent-bar"></div>
    <div class="card-content">
      <p class="quote">
        "Le Très Haut a dit : On vous a prescrit, quand la mort est proche de l'un de vous et s'il laisse des biens, de faire un testament en règle en faveur de ses père et mère et de ses plus proches. C'est un devoir pour les pieux."
        <span class="quote-ref">(Coran, 2:180)</span>
      </p>

      <div class="title-wrap">
        <h1>Testament de {{ testament.createdBy.fullname }}</h1>
        <p>Généré le {{ dateString }}</p>
      </div>

      {% if hasRitesSection %}
        <div class="section">
          <h2 class="section-heading">
            <span class="section-icon" aria-hidden="true">
              <svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
                <path fill-rule="evenodd" d="M9.69 18.933a.75.75 0 0 0 .62 0 16.06 16.06 0 0 0 3.79-2.42c2.637-2.32 4.4-5.25 4.4-8.263 0-4.42-3.58-8-8-8s-8 3.58-8 8c0 3.013 1.763 5.944 4.4 8.263a16.06 16.06 0 0 0 3.79 2.42ZM10 10.25a2.25 2.25 0 1 0 0-4.5 2.25 2.25 0 0 0 0 4.5Z" clip-rule="evenodd"/>
              </svg>
            </span>
            Rites funéraires
          </h2>
          {% if location != '' %}
            <div class="field">
              <p class="field-label">Je souhaite être enterré(e) selon les rites musulmans dans le pays et ou ville suivante :</p>
              <p class="field-value">{{ location }}</p>
            </div>
          {% endif %}
          {% if toilette != '' %}
            <div class="field">
              <p class="field-label">Je souhaite que ma toilette mortuaire soit faite par :</p>
              <p class="field-value">{{ toilette }}</p>
            </div>
          {% endif %}
          {% if family != '' %}
            <div class="field">
              <p class="field-label">Je souhaite que mon enterrement se tienne sans aucune innovation et dans les conditions suivantes :</p>
              <p class="field-value">{{ family }}</p>
            </div>
          {% endif %}
        </div>
      {% endif %}

      {% if hasDebtSection %}
        <div class="section">
          <h2 class="section-heading">
            <span class="section-icon" aria-hidden="true">
              <svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
                <path fill-rule="evenodd" d="M10 18a8 8 0 1 0 0-16 8 8 0 0 0 0 16Zm.75-12a.75.75 0 0 0-1.5 0v.279c-1.158.217-2 1.126-2 2.221 0 1.281 1.138 2.25 2.5 2.25 1.024 0 1.75.67 1.75 1.5s-.726 1.5-1.75 1.5S8 13.08 8 12.25a.75.75 0 0 0-1.5 0c0 1.095.842 2.004 2 2.221V15a.75.75 0 0 0 1.5 0v-.279c1.158-.217 2-1.126 2-2.221 0-1.281-1.138-2.25-2.5-2.25-1.024 0-1.75-.67-1.75-1.5s.726-1.5 1.75-1.5 1.75.67 1.75 1.5a.75.75 0 0 0 1.5 0c0-1.095-.842-2.004-2-2.221V6Z" clip-rule="evenodd"/>
              </svg>
            </span>
            Dettes et engagements
          </h2>
          {% if fixe != '' %}
            <div class="field">
              <p class="field-label">Je souhaite que l’on rembourse mes dettes de la manière suivante :</p>
              <p class="field-value">{{ fixe }}</p>
            </div>
          {% endif %}
          {% if goods != '' %}
            <div class="field">
              <p class="field-label">Je souhaite que l’argent prêté et qui vous sera rendu soit utilisé de la manière suivante :</p>
              <p class="field-value">{{ goods }}</p>
            </div>
          {% endif %}
          {% if lastwill != '' %}
            <div class="field">
              <p class="field-label">Je souhaite laisser les recommandations suivantes :</p>
              <p class="field-value">{{ lastwill }}</p>
            </div>
          {% endif %}
        </div>
      {% endif %}

      {% if hasFastingSection %}
        <div class="section">
          <h2 class="section-heading">
            <span class="section-icon" aria-hidden="true">
              <svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
                <path fill-rule="evenodd" d="M9.598 1.591a.75.75 0 0 1 .638.166 8.25 8.25 0 0 0 9.007 13.395.75.75 0 0 1 .814 1.235A9.75 9.75 0 1 1 8.363.943a.75.75 0 0 1 1.235.648Z" clip-rule="evenodd"/>
              </svg>
            </span>
            Jours de jeûne
          </h2>
          <div class="fasting-box">{{ jeunTextValue }}</div>
        </div>
      {% endif %}

      {% if hasFinancialDetails %}
        <div class="section">
        <h2 class="annex-title">Détails financiers</h2>

        {% if jeds is not empty %}
          <div class="debt-group">
            <h3>On me doit</h3>
            {% for jed in jeds %}
              <div class="debt-card">
                <p class="debt-line">Prêteur : <strong>{{ testament.createdBy.fullname }}</strong></p>
                <p class="debt-line">Emprunteur : <strong>{{ jed.cardOtherName }}</strong> | Tél : <strong>{{ jed.cardOtherTel }}</strong></p>
                <p class="debt-line">Montant initial : <strong>{{ jed.amount }}€</strong></p>
                <p class="debt-line">Montant restant : <strong>{{ jed.remainingAmount }}€</strong></p>
                <p class="debt-line">Date : <strong>{{ jed.dateDisplay }}</strong></p>
              </div>
            {% endfor %}
          </div>
        {% endif %}

        {% if onms is not empty %}
          <div class="debt-group">
            <h3>Je dois</h3>
            {% for onm in onms %}
              <div class="debt-card">
                <p class="debt-line">Emprunteur : <strong>{{ testament.createdBy.fullname }}</strong></p>
                <p class="debt-line">Prêteur : <strong>{{ onm.cardOtherName }}</strong> | Tél : <strong>{{ onm.cardOtherTel }}</strong></p>
                <p class="debt-line">Montant initial : <strong>{{ onm.amount }}€</strong></p>
                <p class="debt-line">Montant restant : <strong>{{ onm.remainingAmount }}€</strong></p>
                <p class="debt-line">Date : <strong>{{ onm.dateDisplay }}</strong></p>
              </div>
            {% endfor %}
          </div>
        {% endif %}

        {% if amanas is not empty %}
          <div class="debt-group">
            <h3>Amanas en cours</h3>
            {% for amana in amanas %}
              <div class="debt-card">
                <p class="debt-line">Entre : <strong>{{ testament.createdBy.fullname }}</strong></p>
                <p class="debt-line">Et : <strong>{{ amana.cardOtherName }}</strong> | Tél : <strong>{{ amana.cardOtherTel }}</strong></p>
                <p class="debt-line">Date : <strong>{{ amana.dateDisplay }}</strong></p>
              </div>
            {% endfor %}
          </div>
        {% endif %}
        </div>
      {% endif %}
    </div>

    <div class="brand">
      <p class="brand-name">MUSLIM CONNECT</p>
      <p class="brand-sub">Document personnel</p>
      <img class="brand-logo" src="{{ logoElhSrc }}" alt="Muslim Connect">
    </div>
  </div>
</div>
</body>
</html>
