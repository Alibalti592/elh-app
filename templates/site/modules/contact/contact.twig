{% extends 'site/layout/layout.html.twig' %}

{% block title %}
  Contactez Muslim Connect
{% endblock %}

{% block description %}
  N'hésitez pas à  nous contactersi vous avez des questions sur l'application Muslim Connect.
{% endblock %}

{% block content_header %}
  <section class="header-page">
    <div class="container">
      <div class="row">
        <div class="col-lg-12">
          <div class="text-center mt-5">
            <h1>
              Nous contacter
            </h1>
          </div>
        </div>
      </div>
    </div>
  </section>
{% endblock %}

{% block content %}
  <section id="page-contact">
    <div class="container">
      <div class="row align-items-center">
        <div class="col-md-6">
          <h2>Une question ou constatez un bug ?</h2>
          <p class="contact-info">
            N'hésitez pas à nous contacter, on répondra rapidement à votre demande <br>
          </p>
        </div>
        <div class="col-md-6">
          <div id="ask-infos">
            <form name="contact" method="post" id="contactForm" action="{{ path("contact_form_submit") }}" class="shadow1">
              <div id="fields-contact">
                {% include 'site/modules/contact/_contact.form.fields.html.twig' %}
              </div>
              <input type="hidden" name="g-recaptcha-response" class="recaptcha" value="">
              <div  id="ajax-loader" class="loader-css">
                <div class="lc1"></div><div class="lc2"></div><div class="lc3"></div><div class="lc4"></div>
              </div>
              <div class="form-group text-center mt-4">
                <button type="submit" class="btn btn-primary w-lg">
                  Envoyer la demande
                </button>
              </div>
            </form>
          </div>
        </div>
      </div>
    </div>

    <!-- Button trigger modal -->
    <div class="modal fade" id="modalSendOK">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
            <h4 class="modal-title">{{ 'contact.send.isSend' | trans }}</h4>
          </div>
          <div class="modal-body">
            <p>
              {{ "contact.send.isSendMessage" |trans|raw }}
            </p>
          </div>
        </div>
      </div>
    </div>
  </section>

{% endblock %}

{% block part_js %}
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
  <script src="https://www.google.com/recaptcha/api.js?render={{ captcha_key_public }}"></script>
  <script>
    grecaptcha.ready(function() {
      grecaptcha.execute('{{ captcha_key_public }}', { action: 'create_comment' }).then(function(token) {
        $('input.recaptcha').val(token);
      });
    });
  </script>
  <script>
    function addFlashMessage(type, message) {
      var classname = "alert alert-"+type+" clearfix";
      var html =
        "<div class='"+classname+"'>"+
        "<button type='button' data-dismiss='alert' class='close' aria-hidden='true'>×</button>"+message+
        "</div>";
      $('.flashes').html(html);
    }

    $('#contactForm').submit( function(event) {
      event.preventDefault();
      var $this = $(this);
      //add loader
      $('#ajax-loader').css('display', 'block');
      $.ajax({
        url: $this.attr('action'),
        type: $this.attr('method'),
        data: new FormData( $this[0] ),
        processData: false,
        contentType: false,
        statusCode: {
          200: function(response) {
            $('#ajax-loader').hide();
            //afficahge envoi OK
            addFlashMessage('success', "Merci, votre message a bien été envoyé !");
            $('input[type="text"], input[type="email"], textarea').val('');
          },
          412: function(response) {
            $('#fields-contact').html(response.errorsForm).promise().done(function(){
              grecaptcha.execute(captcha_key_public, { action: 'create_comment' }).then(function(token) {
                $('input.recaptcha').val(token);
              });
              $('#ajax-loader').hide();
            });
          },
          500: function (response) {
            grecaptcha.execute('{{ captcha_key_public }}', { action: 'create_comment' }).then(function(token) {
              $('input.recaptcha').val(token);
            });
            addFlashMessage('error', "Désolé une erreur s'est produite votre message n'a pas pu être envoyé !");
            $('#ajax-loader').hide();
          }
        }
      });
    });
  </script>
{% endblock %}